# -*- coding: utf-8 -*-
"""ImersÃ£o IA Alura + Google Gemini.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1UeV9-sHh3L8Yk8GnZDY6My1NvFuRz-fh
"""

# Commented out IPython magic to ensure Python compatibility.
# %pip -q install google-genai

import os
from google.colab import userdata

os.environ["GOOGLE_API_KEY"] = userdata.get('GOOGLE_API_KEY')

# Configura o cliente da SDK do Gemini

from google import genai

client = genai.Client()

MODEL_ID = "gemini-2.0-flash"

# Instalar Framework de agentes do Google ################################################
!pip install -q google-adk

from google.adk.agents import Agent
from google.adk.runners import Runner
from google.adk.sessions import InMemorySessionService
from google.adk.tools import google_search
from google.genai import types  # Para criar conteÃºdos (Content e Part)
from datetime import date
import textwrap # Para formatar melhor a saÃ­da de texto
from IPython.display import display, Markdown # Para exibir texto formatado no Colab
import requests # Para fazer requisiÃ§Ãµes HTTP
import warnings

warnings.filterwarnings("ignore")

# FunÃ§Ã£o auxiliar que envia uma mensagem para um agente via Runner e retorna a resposta final
def call_agent(agent: Agent, message_text: str) -> str:
    # Cria um serviÃ§o de sessÃ£o em memÃ³ria
    session_service = InMemorySessionService()
    # Cria uma nova sessÃ£o 
    session = session_service.create_session(app_name=agent.name, user_id="user1", session_id="session1")
    # Cria um Runner para o agente
    runner = Runner(agent=agent, app_name=agent.name, session_service=session_service)
    # Cria o conteÃºdo da mensagem de entrada
    content = types.Content(role="user", parts=[types.Part(text=message_text)])

    final_response = ""
    # Itera assincronamente pelos eventos retornados durante a execuÃ§Ã£o do agente
    for event in runner.run(user_id="user1", session_id="session1", new_message=content):
        if event.is_final_response():
          for part in event.content.parts:
            if part.text is not None:
              final_response += part.text
              final_response += "\n"
    return final_response

# FunÃ§Ã£o auxiliar para exibir texto formatado em Markdown no Colab
def to_markdown(text):
  text = text.replace('â€¢', '  *')
  return Markdown(textwrap.indent(text, '> ', predicate=lambda _: True))

!pip install --upgrade google-api-python-client google-auth-httplib2 google-auth-oauthlib

# Respira â€“ Chatbot com pausa guiada, lembrete via link do Google Agenda e info de pausas
import urllib.parse
from datetime import datetime, timedelta

# ApresentaÃ§Ã£o do chatbot
def apresentar_chatbot():
    print("=" * 30)
    print(" ğŸŒ± Bem-vindo(a) ao Respira! ğŸŒ±")
    print("=" * 30)
    print("\nSeu assistente para pausas conscientes.")
    print("Encontre momentos de equilÃ­brio para sua mente e corpo.")
    print("(Este app nÃ£o substitui um profissional de saÃºde.)\n")

# Obter nome do usuÃ¡rio
def obter_nome_usuario():
    nome = input("Por favor, digite seu nome: ")
    print(f"\nOlÃ¡, {nome}! Que bom ter vocÃª aqui. ğŸ˜Š")
    return nome

# Menu principal
def exibir_menu_principal():
    print("\nâœ¨ Menu Principal âœ¨")
    print("-" * 20)
    print("1. ğŸ§˜ Iniciar uma pausa guiada")
    print("2. â° Criar lembrete de pausa no Google Agenda")
    print("3. ğŸ’¡ Saber mais sobre a importÃ¢ncia das pausas")
    print("4. ğŸ‘‹ Sair")
    print("-" * 20)
    return input("Escolha uma opÃ§Ã£o (1â€“4): ")

# Pausa guiada
def iniciar_pausa_guiada():
    print("\nğŸ§˜ Iniciando pausa guiada...")
    input("Feche os olhos e inspire profundamente... (Enter)")
    input("Expire lentamente pela boca... (Enter)")
    input("Sinta seu corpo relaxando... (Enter)")
    print("\nâœ¨ Pausa concluÃ­da. Respire sempre que precisar.")

# link pro Google Agenda
def criar_lembrete_agenda():
    print("\nâ° Gerando link para o Google Agenda...")
    inicio = datetime.now() + timedelta(minutes=1)
    fim    = inicio + timedelta(minutes=5)

    # Formata 
    inicio_str = inicio.strftime("%Y%m%dT%H%M%S")
    fim_str    = fim.strftime("%Y%m%dT%H%M%S")

    titulo     = urllib.parse.quote("ğŸŒ¿ Pausa consciente - Respira")
    descricao  = urllib.parse.quote("Ã€s vezes tudo o que a gente precisa Ã© de um minuto para voltar pro agora.")

    link = (
      f"https://www.google.com/calendar/render?"
      f"action=TEMPLATE&text={titulo}"
      f"&dates={inicio_str}/{fim_str}"
      f"&details={descricao}"
    )
    print("ğŸ‘‰ Clique ou copie este link no navegador para criar seu lembrete:\n")
    print(link)

# Exibe informaÃ§Ã£o sobre pausas
def exibir_importancia_pausas():
    print("\nğŸ’¡ A ImportÃ¢ncia das Pausas Conscientes ğŸ’¡")
    print("- ReduÃ§Ã£o do estresse e da ansiedade.")
    print("- Melhora da concentraÃ§Ã£o e do foco.")
    print("- Aumento da produtividade.")
    print("- PrevenÃ§Ã£o do esgotamento mental e fÃ­sico.")
    print("- PromoÃ§Ã£o do bemâ€‘estar emocional.")
    print("\nCuide da sua saÃºde mental! Procure um profissional ğŸŒ±")

# FunÃ§Ã£o principal
def main():
    apresentar_chatbot()
    nome = obter_nome_usuario()

    while True:
        opcao = exibir_menu_principal()

        if opcao == '1':
            iniciar_pausa_guiada()
        elif opcao == '2':
            criar_lembrete_agenda()
        elif opcao == '3':
            exibir_importancia_pausas()
        elif opcao == '4':
            print(f"\n{nome}, atÃ© logo! Lembre-se: Ã€s vezes, tudo o que a gente precisa Ã© de um minuto para voltar pro agora. EntÃ£o RESPIRA! ğŸŒ¿")
            break
        else:
            print("âš ï¸ OpÃ§Ã£o invÃ¡lida. Digite um nÃºmero de 1 a 4.")

# Executa
if __name__  == "__main__":
    main()
